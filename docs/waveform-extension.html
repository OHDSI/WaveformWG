<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title> OHDSI Waveform WG</title>

<script src="site_libs/header-attrs-2.30/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />
<link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><div><img src="ohdsi16x16.png"></img> OHDSI Waveform </div></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="get-started.html">
    <span class="fa fa-play"></span>
     
    Get Started
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-heartbeat"></span>
     
    Waveform Extension
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="waveform-extension-overview.html">Overview</a>
    </li>
    <li>
      <a href="waveform-extension.html">Implementation Guide</a>
    </li>
    <li>
      <a href="waveform-tables.html">Table Specifications</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="working-group-proposal.html">Working Group Proposal</a>
    </li>
    <li>
      <a href="office-hours.html">Office Hours</a>
    </li>
    <li>
      <a href="presentations.html">Presentations</a>
    </li>
  </ul>
</li>
<li>
  <a href="project-management.html">
    <span class="fa fa-tasks"></span>
     
    Project Management
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/OHDSI/WaveformWG">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore"><img src="ohdsi40x40.png"></img> OHDSI
Waveform WG</h1>

</div>


<div id="waveform-extension-implementation-guide"
class="section level1">
<h1><strong>Waveform Extension Implementation Guide</strong></h1>
<div id="purpose" class="section level2">
<h2>1. Purpose</h2>
<p>This implementation guide provides detailed specifications for the
OMOP CDM Waveform Extension, including procedures for populating the
following tables: <strong>waveform_occurrence</strong>,
<strong>waveform_registry</strong>, <strong>waveform_feature</strong>,
and <strong>waveform_channel_metadata</strong>.</p>
<p>This guide serves as an addendum to the previously published <a
href="https://chorus-ai.github.io/Chorus_SOP/docs/Multimodal-Linkage/">Multimodal
Linkage SOP</a>, which first introduced the waveform_registry table.
This expanded specification reflects a broader, semantically integrated
model for representing waveform acquisition events, derived features,
and signal metadata.</p>
<p>The updated schema enables consistent ingestion, standardization, and
temporal alignment of physiological waveform data (e.g., ECG, EEG, ABP),
supporting use cases in critical care, AI model development, and
observational research within the OMOP CDM ecosystem.</p>
<p><br></p>
</div>
<div id="scope" class="section level2">
<h2>2. Scope</h2>
<p>Applicable to all ETL pipelines and data engineers responsible for
transforming raw physiological waveform files into OMOP CDM via
harmonized linkage tables.</p>
<p><br></p>
</div>
<div id="table-population-order-rationale" class="section level2">
<h2>3. Table Population Order &amp; Rationale</h2>
<p>The <strong>waveform_occurrence</strong> table must be populated
first, as it defines the core acquisition event and provides a semantic
and temporal anchor for all other tables. Each waveform file
(waveform_registry), feature (waveform_feature), and channel metadata
(waveform_channel_metadata) must link back to this acquisition
context.</p>
<table>
<colgroup>
<col width="5%" />
<col width="27%" />
<col width="66%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Step</th>
<th align="center">Table</th>
<th align="center">Rationale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">waveform_occurrence</td>
<td align="center">Establishes clinical and temporal context for the
recording session</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">waveform_registry</td>
<td align="center">Registers each raw waveform file, linked to the
occurrence</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">waveform_channel_metadata</td>
<td align="center">Describes per-signal-channel metadata for each
registered file</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">waveform_feature</td>
<td align="center">Stores derived features from specific
waveform-channel combinations</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="populate-waveform_occurrence" class="section level2">
<h2>4. Populate waveform_occurrence</h2>
<div id="file-discovery-audit-trail" class="section level3">
<h3>4.1 File Discovery &amp; Audit Trail</h3>
<p>Scan source directories (or data lakes) for waveform files to be
processed, based on project-specific triggers (e.g., hourly ingestion,
daily batch, or one-time archival loads). Files may include both newly
acquired and previously unprocessed recordings.</p>
<p>Maintain an audit trail or metadata log to track:</p>
<ul>
<li>File name and hash</li>
<li>Ingestion timestamp</li>
<li>ETL status (e.g., “pending”, “linked”, “failed”)</li>
<li>Any warnings (e.g., missing timestamps, unmapped formats)</li>
</ul>
<p>Ensure <strong>idempotency</strong> by checking for existing
<code>waveform_target_file_path</code> or file hashes in the
waveform_registry table before processing.</p>
</div>
<div id="extract-metadata" class="section level3">
<h3>4.2 Extract Metadata</h3>
<p>For each newly detected file, extract the following attributes from
file headers (e.g., EDF, WFDB metadata) or companion metadata files:</p>
<ul>
<li>Source path and file name</li>
<li>File extension (e.g., .edf, .csv)</li>
<li>Recording start and end timestamps</li>
<li>Session ID, accession number, or acquisition identifier (if
available)</li>
</ul>
<p>Store this metadata in a temporary staging table or in-memory object
for matching logic.</p>
</div>
<div id="field-specifications" class="section level3">
<h3>4.3 Field Specifications</h3>
<table>
<colgroup>
<col width="1%" />
<col width="10%" />
<col width="2%" />
<col width="2%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Order</th>
<th align="center">Field</th>
<th align="center">Data Type</th>
<th align="center">Required</th>
<th align="center">How to Populate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">waveform_occurrence_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Generate a unique surrogate key. Use a database
sequence or ETL UUID system to guarantee uniqueness across all
acquisition events.</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">waveform_occurrence_concept_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Determine the clinical or operational purpose of the
acquisition (e.g., “ICU telemetry”, “12-lead diagnostic ECG”). Map to a
standard OMOP concept. If no match exists, use a 2-billion custom
concept ID and log it for vocabulary review.</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">person_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Link to the PERSON table using EHR metadata (e.g.,
from admission record, monitoring system export, or device mapping).
Validate that the person exists and is not a test/dummy ID.</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">waveform_occurrence_start_datetime</td>
<td align="center">datetime</td>
<td align="center">Yes</td>
<td align="center">Extract the earliest start timestamp from the
associated waveform files (via headers or metadata). In asynchronous
settings (e.g., streaming), this may precede individual file start
times.</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">waveform_occurrence_end_datetime</td>
<td align="center">datetime</td>
<td align="center">Yes</td>
<td align="center">Extract the latest end timestamp among all associated
files. Can exceed the last file if acquisition continued but files were
truncated or rolled. Ensure end ≥ start.</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">visit_occurrence_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Derive from linked clinical encounter in the EHR.
Join on person_id, acquisition time, or session_id. Use closest visit in
time if exact match is unavailable. Required for OMOP compliance.</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">visit_detail_id</td>
<td align="center">int</td>
<td align="center">Optional</td>
<td align="center">Populate if more granular context is available (e.g.,
ward, unit, device location). Useful in ICU or telemetry use cases.
Leave null if not available.</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">preceding_waveform_occurrence_id</td>
<td align="center">int</td>
<td align="center">Optional</td>
<td align="center">Populate with the waveform_occurrence_id of the
immediately preceding waveform acquisition event for the same person,
when a clear temporal sequence or session linkage is known. Supports
ordered association of sequential recordings. Leave null if this is the
first acquisition or sequencing is unknown.</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">waveform_format_concept_id</td>
<td align="center">int</td>
<td align="center">Optional</td>
<td align="center">Use if the entire acquisition session has a common
format (e.g., WFDB, EDF). Map to OMOP concept if it exists; otherwise,
generate a custom 2-billion concept ID. Skip if formats vary per
file.</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">waveform_occurrence_source_value</td>
<td align="center">string</td>
<td align="center">Recommended</td>
<td align="center">Use the raw session ID, accession number, or study
instance UID from the monitoring system or file metadata. Helps with
traceability and QA.</td>
</tr>
<tr class="odd">
<td align="center">11</td>
<td align="center">num_of_files</td>
<td align="center">int</td>
<td align="center">Recommended</td>
<td align="center">Compute after ingesting linked waveform_registry
entries. Count all files with the same waveform_occurrence_id. Helps in
QA and completeness tracking.</td>
</tr>
<tr class="even">
<td align="center">12</td>
<td align="center">waveform_format_source_value</td>
<td align="center">string</td>
<td align="center">Optional</td>
<td align="center">Store raw label for format as extracted from header
or source system (e.g., “.dat/.hea”, “HL7 aECG”). Helps with
retrospective mapping and vocabulary improvement.</td>
</tr>
</tbody>
</table>
</div>
<div id="common-issues-solutions" class="section level3">
<h3>4.4 Common Issues &amp; Solutions</h3>
<ul>
<li><strong>Missing timestamps</strong> → Estimate using file headers;
flag for manual verification</li>
<li><strong>Multiple visits matched</strong> → Use most specific
visit_detail_id or define business rule</li>
<li><strong>Orphaned acquisitions</strong> → Create visit_occurrence if
necessary (e.g., standalone monitoring session)</li>
</ul>
</div>
<div id="mapping-logic-examples" class="section level3">
<h3>4.5 Mapping Logic Examples</h3>
<ul>
<li><strong>Multiple files per waveform occurrence</strong> →
Supported</li>
<li><strong>One file per waveform occurrence</strong> → Supported</li>
<li><strong>Multiple waveform occurrences per file</strong>:
<ul>
<li>Same acquisition type collected for disconnected periods →
Supported; waveform_registry entry points to earliest
waveform_occurrence; later occurrences use
<code>preceding_waveform_occurrence_id</code></li>
<li>Different acquisition types in overlapping periods → Unsupported;
files must be split by acquisition type</li>
</ul></li>
</ul>
<p><br></p>
</div>
</div>
<div id="populate-waveform_registry" class="section level2">
<h2>5. Populate waveform_registry</h2>
<div id="overview" class="section level3">
<h3>5.1 Overview</h3>
<p>This table records file-level metadata and linkages. Once each file
is linked to a waveform_occurrence, proceed to register each file.</p>
</div>
<div id="field-specifications-1" class="section level3">
<h3>5.2 Field Specifications</h3>
<table>
<colgroup>
<col width="2%" />
<col width="9%" />
<col width="3%" />
<col width="2%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Order</th>
<th align="center">Field</th>
<th align="center">Data Type</th>
<th align="center">Required</th>
<th align="center">How to Populate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">waveform_registry_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Generate a unique surrogate key for each waveform
file. Use an auto-incremented sequence or UUID logic. Must be persistent
across ETL reruns.</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">waveform_occurrence_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Foreign key to the waveform_occurrence table. Must be
resolved before file ingestion by matching session ID or aligning
timestamps. Raise an exception if missing.</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">waveform_feature_id</td>
<td align="center">int</td>
<td align="center">No</td>
<td align="center">Populate only if this file represents a derived
feature (e.g., spectrogram, vectorized representation). Must point to
existing waveform_feature.waveform_feature_id. Leave null for raw
waveform files.</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">person_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Inherit directly from the linked waveform_occurrence.
Do not independently derive from file metadata. Ensures consistency
across tables.</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">waveform_file_start_datetime</td>
<td align="center">datetime</td>
<td align="center">Yes</td>
<td align="center">Extract from file header (e.g., EDF+, WFDB .hea, HDF5
metadata). If unavailable, fallback to
waveform_occurrence_start_datetime but log as approximate.</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">waveform_file_end_datetime</td>
<td align="center">datetime</td>
<td align="center">Yes</td>
<td align="center">Same as above. If duration not explicit, estimate
using sample count × sampling rate. Ensure end ≥ start. If file is a
single snapshot, start = end.</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">visit_occurrence_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Inherit directly from waveform_occurrence. Ensure it
matches the patient’s visit where waveform acquisition occurred.
Required for OMOP compliance.</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">visit_detail_id</td>
<td align="center">int</td>
<td align="center">Optional</td>
<td align="center">Inherit from waveform_occurrence if available. Useful
for ICU or unit-level granularity. Leave null if not tracked.</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">file_extension_concept_id</td>
<td align="center">int</td>
<td align="center">Recommended</td>
<td align="center">Map file extension (e.g., .edf, .csv, .hea) to
standard OMOP concept ID. If not found, assign temporary 2-billion
concept ID and record for future vocabulary harmonization.</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">file_extension_source_value</td>
<td align="center">string</td>
<td align="center">Yes</td>
<td align="center">Store the raw file extension exactly as extracted
from the filename. Examples: .edf, .hea, .mat. Case-sensitive
preservation preferred.</td>
</tr>
<tr class="odd">
<td align="center">11</td>
<td align="center">waveform_source_file_uri</td>
<td align="center">string</td>
<td align="center">Optional</td>
<td align="center">Store the original file path or URI from the source
system. Useful for traceability, re-extraction, or audit. If not
captured, leave null. Encrypt if paths contain PHI.</td>
</tr>
<tr class="even">
<td align="center">12</td>
<td align="center">waveform_target_file_uri</td>
<td align="center">string</td>
<td align="center">Yes</td>
<td align="center">Store the final standardized path, object storage
URI, or relative location in the transformed dataset. Required for
downstream access (e.g., visualization, AI pipelines). Naming
conventions should include waveform_registry_id or session UID.</td>
</tr>
</tbody>
</table>
</div>
<div id="edge-cases" class="section level3">
<h3>5.3 Edge Cases</h3>
<ul>
<li><strong>Missing file timestamps</strong> → Fall back to occurrence;
log reduced precision</li>
<li><strong>Files not uniquely named</strong> → Use hash, device ID, or
accession to disambiguate</li>
<li><strong>Unmapped file extensions</strong> → Temporarily assign
custom concept ID (2B range); notify vocabulary steward</li>
</ul>
<p><br></p>
</div>
</div>
<div id="populate-waveform_channel_metadata" class="section level2">
<h2>6. Populate waveform_channel_metadata</h2>
<div id="overview-1" class="section level3">
<h3>6.1 Overview</h3>
<p>Iterate over each file’s signal channels and extract per-channel
metadata.</p>
</div>
<div id="field-specifications-2" class="section level3">
<h3>6.2 Field Specifications</h3>
<table>
<colgroup>
<col width="2%" />
<col width="12%" />
<col width="4%" />
<col width="7%" />
<col width="73%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Order</th>
<th align="center">Field</th>
<th align="center">Data Type</th>
<th align="center">Required</th>
<th align="center">How to Populate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">waveform_channel_metadata_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Generate a unique surrogate key (integer). Use
database sequence or ETL logic to ensure uniqueness across all channel
metadata entries.</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">waveform_registry_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Foreign key from the associated waveform file
(waveform_registry). Must already exist. Join via filename or internal
file ID parsed from source.</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">procedure_occurrence_id</td>
<td align="center">int</td>
<td align="center">Conditionally Required</td>
<td align="center">Populate if the waveform is tied to a documented
clinical procedure (e.g., diagnostic ECG, EEG study). Extract from EHR
or metadata tags; if not available, leave null.</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">device_exposure_id</td>
<td align="center">int</td>
<td align="center">Optional</td>
<td align="center">Link to device record if available (e.g., from ICU
device logs or telemetry registry). If device is known (Philips monitor,
EEG cap), map via ETL joins; else leave null.</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">waveform_channel_source_value</td>
<td align="center">string</td>
<td align="center">Recommended</td>
<td align="center">Use channel label from the raw waveform file (e.g.,
“Lead II”, “ECG I”, “SpO2”, “ABP”). If not present, derive from channel
index or use placeholder (“Channel 1”).</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">channel_concept_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Map the channel label or signal type to a standard
OMOP concept (2-billion range or community extension). Use a lookup
table for common physiological signals. Log unmapped entries for
review.</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">metadata_source_value</td>
<td align="center">string</td>
<td align="center">Yes</td>
<td align="center">Populate with the metadata type, such as
“sampling_rate”, “gain”, “calibration_factor”, “compression_ratio”.
Extracted from header fields or external metadata.</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">metadata_concept_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Map the metadata_source_value to a standard OMOP
concept (e.g., “Sampling rate” → CONCEPT_ID = X). Maintain an internal
vocabulary map; flag unknowns.</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">value_as_number</td>
<td align="center">float</td>
<td align="center">Optional</td>
<td align="center">Use if the metadata is numeric (e.g., sampling_rate =
500, gain = 0.2). Validate precision and units. Use float type.</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">value_as_concept_id</td>
<td align="center">int</td>
<td align="center">Optional</td>
<td align="center">Use if the value is categorical and can be mapped to
an OMOP concept (e.g., “Invasive” → concept ID, “High Quality” → concept
ID). Optional if stored in value_as_string.</td>
</tr>
<tr class="odd">
<td align="center">11</td>
<td align="center">value_as_string</td>
<td align="center">string</td>
<td align="center">Optional</td>
<td align="center">Use for non-numeric, human-readable metadata (e.g.,
“DC coupling”, “auto-scaled”, “2x compression”). Store raw metadata
value if it doesn’t fit numeric or concept fields.</td>
</tr>
<tr class="even">
<td align="center">12</td>
<td align="center">unit_concept_id</td>
<td align="center">int</td>
<td align="center">Recommended</td>
<td align="center">Populate for physical values (e.g., Hz, mmHg, mV)
using OMOP standard units. Use unit lookup table or join against raw
units found in header.</td>
</tr>
<tr class="odd">
<td align="center">13</td>
<td align="center">unit_source_value</td>
<td align="center">string</td>
<td align="center">Recommended</td>
<td align="center">Raw unit string as it appeared in the source (e.g.,
“Hz”, “mmHg”, “uV”). Helps track unusual or non-standard units and
improves auditability.</td>
</tr>
</tbody>
</table>
</div>
<div id="handling-conflicts" class="section level3">
<h3>6.3 Handling Conflicts</h3>
<ul>
<li><strong>Multiple labels per channel</strong> → Standardize via
channel index</li>
<li><strong>Conflicting sampling rates</strong> → Default to most
frequent or highest resolution</li>
<li><strong>Variable sampling rates</strong> → Use “non-uniform” flag
for irregular time intervals</li>
</ul>
<p><br></p>
</div>
</div>
<div id="populate-waveform_feature" class="section level2">
<h2>7. Populate waveform_feature</h2>
<div id="overview-2" class="section level3">
<h3>7.1 Overview</h3>
<p>Once files are registered and metadata is in place, apply ML
pipelines or signal-processing algorithms to derive waveform features
(e.g., QT interval, entropy, apnea detection).</p>
</div>
<div id="field-specifications-3" class="section level3">
<h3>7.2 Field Specifications</h3>
<table>
<colgroup>
<col width="2%" />
<col width="10%" />
<col width="3%" />
<col width="6%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Order</th>
<th align="center">Field</th>
<th align="center">Data Type</th>
<th align="center">Required</th>
<th align="center">How to Populate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">waveform_feature_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Generate a unique surrogate key (e.g., via sequence
or UUID). Each derived feature must have its own ID.</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">waveform_occurrence_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Foreign key to waveform_occurrence. Must be assigned
from the session that provided the raw waveform data. Extracted from
upstream linkage or stored in intermediate metadata pipeline.</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">waveform_registry_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Foreign key to waveform_registry. Identifies the
specific file from which the feature was extracted. Ensure file was
processed and exists in the registry.</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">waveform_channel_metadata_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Foreign key to waveform_channel_metadata. Indicates
the exact channel used to compute the feature (e.g., ECG Lead II). Use
the signal name and channel index to link.</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">measurement_id</td>
<td align="center">int</td>
<td align="center">Conditionally Required</td>
<td align="center">If the derived feature matches an existing OMOP
MEASUREMENT (e.g., heart rate), populate the appropriate foreign key.
Use LOINC/OMOP vocabularies. Leave null if no standard concept
applies.</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">observation_id</td>
<td align="center">int</td>
<td align="center">Conditionally Required</td>
<td align="center">If the derived feature matches an existing OMOP
OBSERVATION (e.g., “apnea event”), populate the appropriate foreign key.
Use LOINC/OMOP vocabularies. Leave null if no standard concept
applies.</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">algorithm_concept_id</td>
<td align="center">int</td>
<td align="center">Yes</td>
<td align="center">Map the derivation method to a standard OMOP concept
(e.g., “Bazett’s formula”, “HRV SDNN method”). If no concept exists, use
a 2-billion custom ID and record for future standardization.</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">algorithm_source_value</td>
<td align="center">string</td>
<td align="center">Recommended</td>
<td align="center">Record the descriptive name of the algorithm, method,
or software package used (e.g., “Kubios HRV 3.4”, “Neurokit entropy”).
Helps with reproducibility and audit. Null if unknown.</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">anatomic_site_concept_id</td>
<td align="center">int</td>
<td align="center">Optional</td>
<td align="center">If the waveform was collected from a known anatomical
site (e.g., “left wrist”, “chest”), map to a standard OMOP concept.
Helps disambiguate multichannel/multimodal recordings.</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">waveform_feature_start_timestamp</td>
<td align="center">time</td>
<td align="center">Recommended</td>
<td align="center">Start time of the temporal window over which the
feature was derived (e.g., 10:12:00 AM if computed from minute 12). Must
fall within file timestamps.</td>
</tr>
<tr class="odd">
<td align="center">11</td>
<td align="center">waveform_feature_end_timestamp</td>
<td align="center">time</td>
<td align="center">Recommended</td>
<td align="center">End time of the window. Required for interval-based
features like HRV, respiratory rate, or entropy. Equal to start time for
instantaneous features.</td>
</tr>
<tr class="even">
<td align="center">12</td>
<td align="center">is_feature_overflow</td>
<td align="center">boolean</td>
<td align="center">Optional</td>
<td align="center">Populate as TRUE if the feature was derived from
signal segments that span multiple waveform files, occurrences, or
channels. Helps downstream consumers account for composite or stitched
features. Leave NULL if undetermined.</td>
</tr>
<tr class="odd">
<td align="center">13</td>
<td align="center">value_as_number</td>
<td align="center">float</td>
<td align="center">Recommended</td>
<td align="center">Populate if the feature is quantitative (e.g., HR =
75 bpm, Entropy = 0.85). Must be a valid float.</td>
</tr>
<tr class="even">
<td align="center">14</td>
<td align="center">value_as_concept_id</td>
<td align="center">int</td>
<td align="center">Recommended</td>
<td align="center">Use if the feature is categorical (e.g., “Low signal
quality”, “Apnea present”). Map to OMOP concept or use custom 2B
ID.</td>
</tr>
<tr class="odd">
<td align="center">15</td>
<td align="center">value_as_string</td>
<td align="center">string</td>
<td align="center">Optional</td>
<td align="center">Use if the feature cannot be mapped or is stored in
descriptive form (e.g., “artifact detected”, “tachycardia”). Supports
flexibility in early-stage pipelines.</td>
</tr>
<tr class="even">
<td align="center">16</td>
<td align="center">value_is_a_registry_file</td>
<td align="center">boolean</td>
<td align="center">No</td>
<td align="center">Set to TRUE if the feature value is stored as a file
in WAVEFORM_REGISTRY (e.g., time-frequency embedding, long-form entropy
sequence). Typically FALSE for scalar values; only TRUE when feature is
file-based. Helps differentiate scalar vs. file-based features.</td>
</tr>
<tr class="odd">
<td align="center">17</td>
<td align="center">unit_concept_id</td>
<td align="center">int</td>
<td align="center">Recommended if numeric</td>
<td align="center">Required if value_as_number is populated. Map the
physical unit to an OMOP concept (e.g., “ms”, “Hz”, “bpm”).</td>
</tr>
<tr class="even">
<td align="center">18</td>
<td align="center">unit_source_value</td>
<td align="center">string</td>
<td align="center">Recommended if numeric</td>
<td align="center">Record the unit label exactly as it appeared in the
source (e.g., “bpm”, “s”, “mV”). Use for audit and future vocabulary
improvement.</td>
</tr>
</tbody>
</table>
</div>
<div id="common-pitfalls" class="section level3">
<h3>7.3 Common Pitfalls</h3>
<ul>
<li><strong>No clear mapping to MEASUREMENT</strong> → Use
observation_id or record independently</li>
<li><strong>Low-confidence results</strong> → Use external flag table or
quality score field</li>
</ul>
<p><br></p>
</div>
</div>
<div id="validate-control-quality" class="section level2">
<h2>8. Validate &amp; Control Quality</h2>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Check</th>
<th align="center">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Timestamps inconsistent across tables</td>
<td align="center">Reject row, escalate to data QC</td>
</tr>
<tr class="even">
<td align="center">Unmapped concepts</td>
<td align="center">Log and assign temporary ID; notify Standards
team</td>
</tr>
<tr class="odd">
<td align="center">Missing foreign keys</td>
<td align="center">Log and block downstream linkage</td>
</tr>
<tr class="even">
<td align="center">Duplicate files or channels</td>
<td align="center">Hash-based duplication check</td>
</tr>
</tbody>
</table>
<div id="maintain-logs-for" class="section level3">
<h3>8.1 Maintain Logs For</h3>
<ul>
<li>Missing or low-confidence mappings</li>
<li>Outlier timestamps</li>
<li>ETL batch stats: counts, failure reasons, nulls</li>
</ul>
<p><br></p>
</div>
</div>
<div id="post-etl-auditing" class="section level2">
<h2>9. Post-ETL Auditing</h2>
<ul>
<li>Run counts across waveform_occurrence, waveform_registry,
waveform_channel_metadata, waveform_feature</li>
<li>Validate 1:N relationships (e.g., one occurrence → N files)</li>
<li>Validate time consistency between registry and occurrence</li>
<li>Optional: Implement hash-based verification of file integrity</li>
</ul>
<p><br></p>
</div>
<div id="exception-handling" class="section level2">
<h2>10. Exception Handling</h2>
<ul>
<li><strong>Missing occurrence</strong> → Halt file ingestion; generate
ticket</li>
<li><strong>Future datetimes</strong> → Flag as temporal error; require
manual correction</li>
<li><strong>Extension concept missing</strong> → Default to custom
‘unmapped extension’; schedule vocab update</li>
<li><strong>File path missing</strong> → Halt ingestion; escalate to
data engineering</li>
</ul>
<p><br></p>
</div>
<div id="operational-considerations" class="section level2">
<h2>11. Operational Considerations</h2>
<ul>
<li>The registry table may be updated multiple times daily; use batch
loaders</li>
<li>Maintain consistent waveform_registry_id across ETL runs for
idempotency</li>
<li>QC metrics: number of files ingested, timestamps outside expected
windows, missing links per run</li>
<li>Perform daily reconciliation between source files and registry
entries</li>
</ul>
<p><br></p>
</div>
<div id="audit-trail-lineage" class="section level2">
<h2>12. Audit Trail &amp; Lineage</h2>
<p>Every row insertion/update in waveform_registry must include
<code>record_insert_datetime</code>, <code>record_source_system</code>,
and <code>etl_run_id</code>, ensuring reproducibility and
provenance.</p>
<p><br></p>
</div>
<div id="dependencies" class="section level2">
<h2>13. Dependencies</h2>
<p>Relies on:</p>
<ul>
<li>Properly populated waveform_occurrence, PERSON, VISIT_OCCURRENCE,
and vocabulary tables</li>
<li>Access to controlled ETL staging directories</li>
<li>External mapping file from extensions to OMOP extension concept
IDs</li>
</ul>
<p><br></p>
</div>
<div id="update-management" class="section level2">
<h2>14. Update Management</h2>
<ul>
<li>Changes to extension mappings must be versioned via an internal
registry and reviewed</li>
<li>Major schema changes trigger updates to this implementation
guide</li>
</ul>
<p><br></p>
</div>
<div id="compliance-tools" class="section level2">
<h2>15. Compliance &amp; Tools</h2>
<ul>
<li>Use standard SQL-based insertion/upsert logic</li>
<li>Implement CI tests for field-level constraints</li>
<li>Leverage ETL orchestration tools (e.g., Airflow, Prefect) to
schedule ingestion, validation, and logging</li>
</ul>
<p><br></p>
</div>
<div id="contact-information" class="section level2">
<h2>16. Contact Information</h2>
<ul>
<li><strong>Email</strong>: Jared Houghtaling (<a
href="mailto:jared.houghtaling@tuftsmedicine.org"
class="email">jared.houghtaling@tuftsmedicine.org</a>)</li>
<li><strong>Email</strong>: Polina Talapova (<a
href="mailto:ptalapova@tuftsmedicine.org"
class="email">ptalapova@tuftsmedicine.org</a>)</li>
<li><strong>Email</strong>: Brian Gow (<a href="mailto:briangow@mit.edu"
class="email">briangow@mit.edu</a>)</li>
</ul>
<p><br></p>
</div>
<div id="related-resources" class="section level2">
<h2>17. Related Resources</h2>
<p>See <a href="office-hours.html">Office Hours</a> for recorded
implementation discussions and Q&amp;A sessions.</p>
<p><br></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
